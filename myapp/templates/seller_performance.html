{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</title>

    <!-- ‚úÖ CSS -->
    <link rel="stylesheet" href="{% static 'styles/seller_performance.css' %}">
    <link rel="stylesheet" href="{% static 'styles/sidebar.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Font Awesome ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- Mobile Hamburger Menu -->
    <div class="hamburger-menu" id="hamburger-menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <h2 class="sidebar-title">
                <i class="fas fa-store"></i> Genni Shop
            </h2> 
            <ul class="menu">
                <li class="menu-header"><i class="fas fa-shopping-cart"></i> ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</li>
                <li class="menu-item"><a href="{% url 'seller_dashboard' %}"><i class="fas fa-chart-line"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a></li>
                <li class="menu-item"><a href="{% url 'seller_orders' %}"><i class="fas fa-box"></i> ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
                <li class="menu-item"><a href="{% url 'seller_payment_verification' %}"><i class="fas fa-credit-card"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a></li>
                <li class="menu-item"><a href="{% url 'seller_refund_requests' %}"><i class="fas fa-undo"></i> ‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>

                <li class="menu-header"><i class="fas fa-tags"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</li>
                <li class="menu-item"><a href="{% url 'my_products' %}"><i class="fas fa-cubes"></i> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
                <li class="menu-item"><a href="{% url 'add_product' %}"><i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</a></li>

                <li class="menu-header"><i class="fas fa-chart-bar"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</li>
                <li class="menu-item active"><a href="{% url 'seller_performance' %}"><i class="fas fa-award"></i> ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
                <li class="menu-item"><a href="{% url 'seller_notifications_lists' %}"><i class="fas fa-bell"></i> ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</a></li>
                <li class="menu-item"><a href="{% url 'seller_reviews' %}"><i class="fas fa-star"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a></li>
            
                <li class="menu-header"><i class="fas fa-cog"></i> ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</li>
                <li class="menu-item"><a href="{% url 'edit_store' %}"><i class="fas fa-store-alt"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</a></li>
                <li class="menu-item"><a href="{% url 'edit_seller_profile' %}"><i class="fas fa-user-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a></li>
                <li class="menu-item"><a href="{% url 'seller_wallet' %}"><i class="fas fa-wallet"></i> ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô</a></li>
                <li class="menu-item logout"><a href="{% url 'seller_logout' %}"><i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></li>
            </ul>
        </aside>


        <!-- üåü Main Content -->
        <div class="container">
            <h2>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
          
            <div class="report-card">
              <h3>üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</h3>
              <p class="money">‡∏ø{{ total_sales }}</p>
            </div>
          
            <h3>üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ (5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å)</h3>
            <table class="table">
              <thead>
                <tr><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</th></tr>
              </thead>
              <tbody>
                {% for product in top_products %}
                <tr><td>{{ product.name }}</td><td>{{ product.total_sold_count }}</td></tr>
                {% empty %}
                <tr><td colspan="2">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</td></tr>
                {% endfor %}
              </tbody>
            </table>
          
            <div class="report-card">
              <h3>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h3>
              <p>{{ avg_rating|floatformat:1 }}/5.0</p>
            </div>
          
            <h3>üìù ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <ul class="review-list">
              {% for review in recent_reviews %}
              <li>
                <strong>{{ review.product.name }}</strong> - ‚≠ê {{ review.rating }}/5
                <p>"{{ review.comment }}"</p>
                <small>‡πÇ‡∏î‡∏¢ {{ review.user.username }} ‡πÄ‡∏°‡∏∑‡πà‡∏≠ {{ review.created_at|date:'d/m/Y' }}</small>
              </li>
              {% empty %}
              <li>‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</li>
              {% endfor %}
            </ul>
          
            <!-- üìä ‡∏Å‡∏£‡∏≤‡∏ü -->
            <div class="charts-section">
              <div class="chart-card">
                <h3>üèÜ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Top 10</h3>
                <div class="chart-container">
                  <canvas id="top10SalesChart"></canvas>
                </div>
              </div>
              <div class="chart-card">
                <h3>üìÖ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                <div class="chart-container">
                  <canvas id="monthlySalesChart"></canvas>
                </div>
              </div>
              <div class="chart-card">
                <h3>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß (‡∏£‡∏ß‡∏°)</h3>
                <div class="chart-container">
                  <canvas id="reviewDonutChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Chart.js -->
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          
          <script>
            const top10Names = JSON.parse('{{ top10_names|safe }}');
            const top10Counts = JSON.parse('{{ top10_counts|safe }}');
            const monthlyLabels = JSON.parse('{{ monthly_labels|safe }}');
            const monthlySales = JSON.parse('{{ monthly_sales|safe }}');
            const reviewData = JSON.parse('{{ review_distribution|safe }}');
          
            const top10Chart = new Chart(document.getElementById("top10SalesChart"), {
              type: 'bar',
              data: {
                labels: top10Names,
                datasets: [{
                  label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢ (‡∏ä‡∏¥‡πâ‡∏ô)',
                  data: top10Counts,
                  backgroundColor: 'rgba(54, 162, 235, 0.6)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1
                }]
              },
              options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    ticks: {
                      callback: function(value) {
                        const label = this.getLabelForValue(value);
                        return label.length > 30 ? label.substring(0, 30) + '...' : label;
                      },
                      font: { size: 12 }
                    }
                  },
                  x: { beginAtZero: true }
                },
                plugins: {
                  legend: { display: false },
                  tooltip: {
                    callbacks: {
                      title: function(tooltipItems) {
                        const label = tooltipItems[0].label;
                        return label.length > 60 ? label.substring(0, 60) + '...' : label;
                      }
                    }
                  }
                }
              }
            });
          
            const monthlyChart = new Chart(document.getElementById("monthlySalesChart"), {
              type: 'line',
              data: {
                labels: monthlyLabels,
                datasets: [{
                  label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
                  data: monthlySales,
                  fill: true,
                  borderColor: '#f97316',
                  backgroundColor: 'rgba(249, 115, 22, 0.2)',
                  tension: 0.3
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: { beginAtZero: true }
                }
              }
            });
          
            const reviewDonut = new Chart(document.getElementById("reviewDonutChart"), {
              type: 'doughnut',
              data: {
                labels: ['‚≠ê 5', '‚≠ê 4', '‚≠ê 3', '‚≠ê 2', '‚≠ê 1'],
                datasets: [{
                  data: reviewData,
                  backgroundColor: ['#4caf50','#8bc34a','#ffeb3b','#ffc107','#f44336']
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { position: 'bottom' }
                }
              }
            });
            
          </script>
          
          </body>
          </html>