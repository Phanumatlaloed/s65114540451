{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíº ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="{% static 'styles/admin_withdrawals.css' %}">
</head>
<body>
    <div class="container">
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö -->
        <a href="{% url 'admin_dashboard' %}" class="back-button">
            <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
        </a>
        
        <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
        <h2>üíº ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå -->
        <form method="get" action="{% url 'admin_withdrawals' %}">
            <div class="filters">
                <!-- ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                <div class="filter-group">
                    <label for="store_name">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="text" name="store_name" id="store_name" value="{{ request.GET.store_name }}" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤">
                </div>
        
                <!-- ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
                <div class="filter-group">
                    <label for="start_date">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" name="start_date" id="start_date" value="{{ request.GET.start_date }}">
                </div>
                
                <div class="filter-group">
                    <label for="end_date">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" name="end_date" id="end_date" value="{{ request.GET.end_date }}">
                </div>
        
                <!-- ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠ -->
                <div class="filter-group">
                    <label for="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                    <select name="status" id="status">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                        <option value="approved" {% if request.GET.status == 'approved' %}selected{% endif %}>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                        <option value="rejected" {% if request.GET.status == 'rejected' %}selected{% endif %}>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option>
                    </select>
                </div>
        
                <button type="submit" class="btn-apply-filter">
                    <i class="fas fa-filter"></i> ‡πÉ‡∏ä‡πâ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå
                </button>
            </div>
        </form>
        
        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô -->
        {% if withdrawals %}
            <table class="table">
                <thead>
                    <tr>
                        <th>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                        <th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</th>
                        <th>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for withdrawal in withdrawals %}
                    <tr>
                        <td>{{ withdrawal.seller.store_name }}</td>
                        <td>{{ withdrawal.seller.bank_account_name|default:"-" }}</td>
                        <td>{{ withdrawal.seller.bank_account_number|default:"-" }}</td>
                        <td>{{ withdrawal.seller.bank_name|default:"-" }}</td>
                        <td>‡∏ø{{ withdrawal.amount }}</td>
                        <td>
                            {% if withdrawal.status == "pending" %}
                                <span class="status pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                            {% elif withdrawal.status == "approved" %}
                                <span class="status approved">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                            {% elif withdrawal.status == "rejected" %}
                                <span class="status rejected">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if withdrawal.payment_proof %}
                                <a href="{{ withdrawal.payment_proof.url }}" target="_blank" class="btn-view">
                                    <i class="fas fa-file-invoice"></i> ‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ
                                </a>
                            {% else %}
                                <span class="no-proof">
                                    <i class="fas fa-ban"></i> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="actions">
                                {% if withdrawal.status == "pending" %}
                                    <form method="post" action="{% url 'approve_withdrawal' withdrawal.id %}" enctype="multipart/form-data" class="action-form">
                                        {% csrf_token %}
                                        <div class="file-upload-wrapper">
                                            <input type="file" name="payment_proof" required id="payment_proof_{{ withdrawal.id }}" class="file-upload">
                                            <label for="payment_proof_{{ withdrawal.id }}" class="file-label">
                                                <i class="fas fa-upload"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
                                            </label>
                                        </div>
                                        <button type="submit" class="btn-approve">
                                            <i class="fas fa-check"></i> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                        </button>
                                    </form>
                                    <form method="post" action="{% url 'reject_withdrawal' withdrawal.id %}" class="action-form">
                                        {% csrf_token %}
                                        <button type="submit" class="btn-reject">
                                            <i class="fas fa-times"></i> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                                        </button>
                                    </form>
                                {% elif withdrawal.status == "approved" and withdrawal.confirmed_by_seller == False %}
                                    {% if request.user.is_seller %}
                                        <form method="post" action="{% url 'confirm_withdrawal' withdrawal.id %}" class="action-form">
                                            {% csrf_token %}
                                            <button type="submit" class="btn-confirm">
                                                <i class="fas fa-check-double"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
                                            </button>
                                        </form>
                                    {% else %}
                                        <span class="disabled">
                                            <i class="fas fa-clock"></i> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                                        </span>
                                    {% endif %}
                                {% else %}
                                    <span class="disabled">
                                        <i class="fas fa-check-circle"></i> ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß
                                    </span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-requests">
                <i class="fas fa-exclamation-circle"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
            </p>
        {% endif %}
    </div>

    <script>
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î
        document.addEventListener('DOMContentLoaded', function() {
            const fileInputs = document.querySelectorAll('.file-upload');
            fileInputs.forEach(input => {
                input.addEventListener('change', function() {
                    const label = this.nextElementSibling;
                    if (this.files.length > 0) {
                        label.innerHTML = `<i class="fas fa-check"></i> ${this.files[0].name}`;
                        label.classList.add('file-selected');
                    } else {
                        label.innerHTML = `<i class="fas fa-upload"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ`;
                        label.classList.remove('file-selected');
                    }
                });
            });
        });
    </script>
    
</body>
</html>